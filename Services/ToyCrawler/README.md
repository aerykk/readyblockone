


GOOD AUSSY SITE (SEA COW) http://www.justbricks.com.au/lego-products/the-lego-movie/
GOOD US SITE http://www.toyoutletdirect.com/product/969047/

CLI

scan-set
--clear-saved-data
--clear-saved-link

eg. DEBUG=x-ray,x-ray:phantom,superagent,nightmare,casper node cli.js scan-set 70801 --clear-saved-link


scout

eg. node cli.js scout 70801


TODO: amazon uk, tru ebay ca, tru ca, amazon ca, ebay tru ca       

// arbitrage http://www.factorydirect.ca/AppleProducts.aspx?param=CBH9QUNihPZOIasbjCQKrvuVYGDYANW0



// get microfighters on may 2nd

// 75030 // get 3x falcon
// 75032 // get 2x x-wing
// 75031 // get 1x tie
// 75075 // get 1x at at
// get 76011 man bat


// http://www.toysrus.ca/product/index.jsp?productId=12168095
// http://www.toysrus.ca/product/index.jsp?productId=11348888
// http://www.toysrus.ca/product/index.jsp?productId=19791906

// get the owned/wants from brickset
// get the sold in last month from brickset

// check out TRU collectables http://www.toysrus.ca/shop/index.jsp?categoryId=46528836

// buy if % RSP - set-list.csv

// check http://shop.lego.com/en-CA/catalog/productListing.jsp?_requestid=2767427 for title diffs
// check 

// get RSP, rating, etc. from lego.ca

// add item to cart on lego.com to check for additional discount

// add item to cart on toysrus.ca to check for coupon application

// canipricematch.com? // check walmart/toysrus/chapters price match

// check future shop, sears, canadian tire, london drugs
// http://www.bestbuy.ca/Search/SearchResults.aspx?filter=category%253aToys%252c+Sports+%2526+Recreation%253bcategory%253aToys%252c+Games+%2526+Collectibles%253bbrandName%253aLEGO
// http://www.canadiantire.ca/en/search-results.html?searchByTerm=true&q=lego
// http://www.mastermindtoys.com/catalog/searchresults.aspx?search=lego
// http://www.sears.ca/catalog/legomd/100003664
// http://www.sears.ca/catalog/lego/11050-100003664/0?gclid=CI6kubvSksUCFRSIfgodbwQA-A&extid=050214_ca_1search_2en_3gogl_4toy_5en-toy-lego-brands-bmm_6Building---Lego&s_kwcid=AL!4202!3!48046205401!b!!s!!lego%20starwars%20online&ef_id=ZHRPrv30oE8AAFmP:20150425234847:s
// http://www.mastermindtoys.com/catalog/searchresults.aspx?search=lego
// AMAZON CO UK
// http://www.mastermindtoys.com/LEGO-Hard-To-Find.aspx
// amazon.ca from amazon http://www.amazon.ca/s/ref=sr_in_-2_p_6_1?fst=as%3Aoff&rh=n%3A6205517011%2Cn%3A6303772011%2Cn%3A6742029011%2Ck%3Alego%2Cp_89%3ALEGO%2Cp_6%3AA3DWYIK6Y9EEQB&bbn=6742029011&sort=price-desc-rank&keywords=lego&ie=UTF8&qid=1429425903&rnid=6898383011
// amazon.ca lego store http://www.amazon.ca/s/ref=lp_10453388011_st?qid=1429426255&rh=n%3A6205517011%2Cn%3A%216712289011%2Cn%3A%216712290011%2Cn%3A10453388011&sort=price-desc-rank
// http://www.staples.ca/
// rakuten global http://global.rakuten.com/en/search/?tl=&k=lego+4865
// rakuten japan? http://search.rakuten.co.jp/search/mall/lego+4865/-/st.A?grp=product
// http://mrstiggywinkles.ca/product/40332-lego-city-pickup-tow-truck/
// http://www.disneystore.com/disney/store/DSISearch?Searchstr=lego&storeId=10051&catalogId=10002&langId=-1&pageCmdName=dsi:productListPage&Ntx=mode+matchallpartial&N=0&Nu=pProductID&Nr=pPublished%3A1&Ntk=All_Shopping&Ntt=lego&D=lego&Dr=pPublished%3A1&typeAhead=1
// http://duclostoys.com/lego/
// https://www.toysonfire.ca/shop?search=lego
// https://spectrum-nasco.ca/catalogsearch.htm?Action=Display&Search=LEGO&PLPG=ECCDEY%20-%20LEGO%20THEMED%20SETS
// http://www.grammastoyshop.ca/

// find out what has the highest price difference between japan and canada, stock up, fly over and sell

// read DR plan
// https://www.google.com/search?q=Dave+Ramsey+plan&oq=Dave+Ramsey+plan&aqs=chrome..69i57.892j0j1&sourceid=chrome&es_sm=91&ie=UTF-8

// maybe get:
// http://www.educationstation.ca/detail.php?id=144952 normal bricks
// http://www.educationstation.ca/detail.php?id=144948 old green plate
// https://spectrum-nasco.ca/product.htm?Product=89268T&Source=Search base plates
// https://spectrum-nasco.ca/product.htm?Product=731701&Source=Search building plates
// pieces https://spectrum-nasco.ca/product.htm?Product=89251T&Source=Search
// pieces https://spectrum-nasco.ca/product.htm?Product=89306&Source=Search
// pieces https://spectrum-nasco.ca/product.htm?Product=444130&Source=Search
// http://www.educationstation.ca/detail.php?id=144951 interesting
// http://www.educationstation.ca/detail.php?id=144955
// http://www.playvaluetoys.com/products/LEGO-9466.html
// http://www.playvaluetoys.com/products/LEGO-41006.html 1
// http://www.playvaluetoys.com/products/LEGO-9463.html definitely 3
// http://www.playvaluetoys.com/products/LEGO-79005.html definitely lots 5
// http://www.playvaluetoys.com/products/LEGO-8804.html buy based on:
// http://www.ebay.ca/itm/LEGO-MINIFIGURES-SERIES-4-8804-16-NEW-RANDOM-MYSTERY-PACKS-/231524481352?pt=LH_DefaultDomain_0&hash=item35e7ef3948
// http://www.playvaluetoys.com/products/LEGO-9462.html yes 
// http://www.brickpicker.com/bpms/set.cfm?set=9464-1 yes
// http://www.playvaluetoys.com/products/LEGO-9466.html yes
// http://www.playvaluetoys.com/products/LEGO-7985.html probably
// http://www.playvaluetoys.com/products/LEGO-9515.html definitely

//  from migatoy
// http://migatoy.ca/lego-on-sale/lego-the-hobbits/ - Lego 79003 Hobbit An Unexpected Gathering
// http://migatoy.ca/lego-on-sale/lego-monster-fighters/ Lego 9468 Monster-Vampyre Castle
// http://migatoy.ca/lego-on-sale/lego-advanced-models-rare-hard-to-find/ Lego 10211 Creator-Grand Emporium
// Lego 10235 Winter Village Market
// Lego 21110 Research Institute
// http://migatoy.ca/lego-on-sale/lego-architecture/ Lego 21002  Empire State Building
// http://migatoy.ca/lego-on-sale/lego-starwars/ Lego 10188 Star Wars Death Star

// get high CARG from brickpicker and run against inventory

// get how many sold on ebay


// make kitten for akari 30188

// compare against http://camelcamelcamel.com/LEGO-City-Police-Helicopter-7741/product/B000WNUU6Y?context=browse

// type in a set ID to check if its in stock in all stores

// keep track how many times it went sold out on which store

// retired checker
// "Discontinued by manufacturer: Yes" on amazon.com http://www.amazon.com/LEGO-Movie-70804-Cream-Machine/dp/B00GSPFD08

// stacking bins http://www.amazon.ca/Stanley-056400L-Bin-No-4/dp/B001K3WW6Q/ref=sr_1_14?s=hi&ie=UTF8&qid=1429471432&sr=1-14&keywords=stanley+organizer
// http://www.amazon.ca/Original-Pink-Box-PB30MPB-Drawer/dp/B00FAMK6Z2/ref=sr_1_fkmr2_1?s=hi&ie=UTF8&qid=1429471626&sr=1-1-fkmr2&keywords=northern+tool+bin
// nice http://www.northerntool.com/shop/tools/product_200335439_200335439
// 

// for organization http://www.amazon.ca/Stanley-Removable-Compartment-Professional-Organizer/dp/B001G1CUK0

// track pokemon zukan Pokemon Zukan Figures Zukan figures are some of the nicest figures you can at any time invest in. Zukan figures are bought in Gashapon machines in Japan. They are scaled to one/fortieth sizing of the Pokemon they are dependent off of (even though in some cases, 1/fiftieth size since the determine would be far too huge to fit into the capsule). Each individual Pokemon has a zukan, minus Onix, Steelix, and about 95% of 5th era so considerably. 


// monitor this thread
// http://forums.redflagdeals.com/merged-fun-official-lego-thread-new-tru-other-general-things-850561/336/

// monitor this thread 
// http://www.brickpicker.com/forum/index.php?/forum/28-lego-set-retirement-end-of-life-eol/



// get this book on row houses http://www.ebay.ca/itm/Lego-Custom-Modular-Building-Mansard-Row-House-INSTRUCTIONS-ONLY-10228-/271153363498?pt=LH_DefaultDomain_0&hash=item3f21fffa2a


// get a no FTF visa: http://community.brickpicker.com/topic/13928-daily-lego-deals-4232015/#comment-452754


// compile a list of sets that are retired and selling below MSRP
// cross reference the genre for good/bad investment genres
// corss reference price for low/high best investment

// more toy stores:
// http://www.tipbusters.com/shopping/
// http://www.craveonline.com/lifestyle/articles/179977-top-10-canadian-toy-stores

// http://toys.scholarschoice.ca/catalogsearch/result/?q=lego&x=0&y=0
// http://mrstiggywinkles.ca/search/?query=lego&records=21
// http://divertioz.com/store/search.php?phrase=lego&x=0&y=0
// http://www.kaboodlestoystore.com/locations/granville-island-vancouver-toy-store/
// http://www.robotbuy.ca/index.php?search_str=lego&x=0&y=0&p=catalog&mode=search&search_in=all
// http://www.toycompany.com/index.php?keyword=lego&option=com_virtuemart&page=shop.browse&Itemid=26
// http://www.mindsalive.ca/search.asp?keyword=lego&search= has museum break in
// lego timepeace http://www.hammacher.com/Product/84990?promo=search
// maybe http://www.littlefootprintstoys.com/store/SiteDocs/Brand?Open&submenuheader=5
// i like thi sdesign http://www.learningtoys.ca/english/catalogsearch/result/?q=lego
// http://www.funkytoys.net/lego/
// http://treasureislandtoys.ca/collections/shop-by-brand/LEGO
// https://hobbyandtoycentral.com/?q=products&f[0]=field_supplier%3A739
// http://www.geniusshacktoys.ca/cgi-geniusshacktoys/sb/productsearch.cgi?storeid=*22b712ca689da874baac70040027857d5e5b23&search_field=lego&x=0&y=0
// http://www.wizkidz.ca/brands/?brand=117
// http://www.mindgames.ca/search?q=lego
// USA SHIPS TO CANADA
// HMM
// USA ONLY SHIPS USA
// http://www.barstonschildsplay.com/index.php?option=com_virtuemart&page=shop.browse&Itemid=26&category_id=0&manufacturer_id=259&age_id=&fundamental_id=0&price_id=0&orderby=product_relevance&filter_status=closed&keyword1=&keyword2=&limitstart=30&limit=30

// script this
// http://go.redirectingat.com/?id=33822X916520&site=brickpicker.com&xs=1&isjs=1&url=http%3A%2F%2Fwww.ebay.com%2Fitm%2F100-Babies-R-Us-Gift-Card-for-80-US-Mail-Delivery-%2F371312875491%3Fcustomid%3Dd204cd80cc6d4eaeb153f4b59b64f6a9%26pub%3D5574652453%26afepn%3D5337259887%26campid%3D5337259887%26pt%3DLH_DefaultDomain_0%26var%3D%26hash%3Ditem5673f8d7e3%26afepn%3D5337259887%26rmvSB%3Dtrue&xguid=902631dcd52c0e9cd9db3eace07b9a4b&xuuid=af1a5bb8e93cb90391746abef9a8538d&xsessid=e327acec8d96553b25c9f679e75a235a&xcreo=0&xed=0&sref=http%3A%2F%2Fcommunity.brickpicker.com%2Ftopic%2F13971-daily-lego-deals-4272015%2F%3Fpage%3D2%23comment-453976&xtz=420

// read this
// http://www.shapiro.com/amazon-fba/

// check TRU ebay
// http://www.ebay.ca/sch/m.html?_odkw=&_ssn=toysruscanada&_armrs=1&_osacat=0&_from=R40&_trksid=p2046732.m570.l1313.TR0.TRC0.H0.Xlego.TRS0&_nkw=lego&_sacat=0


// monitor for things like GC
// http://www.ebay.com/itm/like/261855472080?item=261855472080&lgeo=1&vectorid=229466&rmvSB=true


// so much good info on shipping
// http://community.brickpicker.com/topic/13968-how-am-i-going-to-sell-all-this-lego/?page=3#comment-454309

// almsot seems like  a buy
// http://www.playvaluetoys.com/products/LEGO-7957.html

// definite buy
// buy http://www.wizkidz.ca/lego-castle-king-s-castle

// NOW NOW NOW http://www.toysense.ca/buy/leg7592/construct-a-buzz-retired-product
// NOW NOW NOW http://www.toysense.ca/buy/leg76000/arctic-batman-vs-mr-freeze-aq
// NOW NOW NOW http://www.toysense.ca/buy/leg6863/batwing-battle-over-gotham-city-retired-product
// NO WNOW NOW http://www.toysense.ca/buy/leg8096/emperor-palpatines-shuttle-retired-product
// NOW NOW KINDA XXX http://www.toysense.ca/buy/leg8088/arc-170-starfighter-retired-product
// nice 
// http://www.toysense.ca/buy/leg4648590/minifigure-series-7-open-stock-retired-product
// http://www.toysense.ca/buy/leg8803/minifigures-series-3-open-stock-retired-product
// http://www.toysense.ca/buy/leg8804/minifigures-series-4-retired-product
// http://www.toysense.ca/buy/leg4614612/minifigures-series-5-open-stock-retired-product
// nice http://www.toysense.ca/buy/leg42028/bulldozer
// http://www.toysense.ca/buy/leg76001/the-bat-vs-bane-tumbler-chase
// http://www.toysense.ca/buy/leg9516/jabbas-palace
// maybe http://www.toysense.ca/buy/leg8083/rebel-trooper-battle-pack-retired-product
// maybe http://www.toysense.ca/buy/leg9450/epic-dragon-battle
// maybe http://www.toysense.ca/buy/leg9449/ultra-sonic-raider
// maybe http://www.toysense.ca/buy/leg70500/kais-fire-mech
// http://www.toysense.ca/buy/leg9473/the-mines-of-moria-retired-product
// http://www.funkytoys.net/lego-monster-fighters-9461-the-swamp-creature/
// buy http://www.toysense.ca/buy/leg9467/the-ghost-train-retired-product
// http://www.toysense.ca/buy/leg9462/the-mummy-retired-product
// buy one anyway
// http://www.toysense.ca/buy/leg79001/escape-from-mirkwood-spiders
// http://www.toysense.ca/buy/leg79012/mirkwoods-elf-army
// http://www.toysense.ca/buy/leg79011/dol-guldur-ambush

// how to use gift card bar code scans
// http://community.brickpicker.com/topic/13992-daily-lego-deals-4292015/#comment-454365


// toys r us sales:
// http://www.toysrus.ca/family/index.jsp?categoryId=64534826
// http://dl.dropbox.com/u/58484258/Screenshots/lz7o.png
// http://www.toysrus.ca/home/index.jsp?categoryId=2567269&overrideStore=TRUSCA

// BUY LIST

// http://www.toysense.ca/buy/leg6863/batwing-battle-over-gotham-city-retired-product
// http://www.funkytoys.net/lego-star-wars-75040-general-grievous-wheel-bike/
// http://www.funkytoys.net/lego-star-wars-75035-kashyyyk-troopers/
// http://www.toysense.ca/buy/leg7930/bounty-hunter-assault-gunship-retired-product
// http://www.toysense.ca/buy/leg7959/geonosian-starfighter-retired $40 to 79
// http://www.toysense.ca/buy/leg9677/x-wing-starfighter-yavin-4-retired-product






// var update_lookupDelay = 0;

// function update() {
//     console.log('Updating..');

//     var target = 'getAmazonData';
//     var date = new Date();

//     date.setDate(date.getDate()-1); // subtract 1 day

//     new Set()
//         .query('where', 'updatedAt', '<=', date.toISOString().replace(/\T.+/, ''))
//         .query('limit', 10)
//         .fetchAll()
//         .then(function(models) {
//             models.mapThen(function(model) {
//                 var set = model.attributes;
//                 var setNumber = set.setNumber;

//                 update_lookupDelay += 3000;

//                 setTimeout(function() {
//                     var url = 'http://www.amazon.ca/s/ref=nb_sb_noss_2?url=search-alias%3Daps&field-keywords=lego+' + setNumber;

//                     xray(url)
//                       .prepare({
//                         trim: function(value) {
//                             return value.replace(/^\s+|\s+$/g, '');
//                         },
//                         currency: function(value) {
//                             return parseFloat(value.replace('CDN$', ''));
//                         }
//                       })
//                       .select({
//                         $root: '.s-item-container:first-child',
//                         currentPrice: '.s-price | trim | currency',
//                         cheapestPrice: '.a-size-small .a-color-price | trim | currency'
//                       })
//                       .run(function(err, product) {
//                         if (!product) { return; }

//                         var amazonData = {
//                             price: product.cheapestPrice ? product.cheapestPrice : product.currentPrice,
//                             currentPrice: product.currentPrice,
//                             cheapestPrice: product.cheapestPrice
//                         };

//                         console.log('Got data for set ' + setNumber + ' from Amazon.ca', amazonData);

//                         saveSetLookup(setNumber, target, amazonData, function(lookup) {
//                             if (!set.data.retailers) {
//                                 set.data.retailers = {};
//                             }

//                             set.data.retailers['Amazon CA'] = amazonData;

//                             saveSet(set, function() {

//                             });
//                         });

//                         update_lookupDelay -= 3000;
//                       });
//                 }, update_lookupDelay);
//             });
//         })
//         .catch(function(err) {
//             console.log("Error: " + err);
//         });

//     setTimeout(update, 2 * 60 * 1000); // Start up again in 2 minutes
// }





                runToySense(function(items) {
                    var sets = {};

                    items.forEach(function(item) {
                        if (!item.setNumber) {
                            falcon.getSetNumberFromTitle(item.title, function(setNumber) {
                                item.setNumber = setNumber;

                                falcon.shouldNotifyAboutSet('Toy Sense', item.title, item.setNumber, item.link, item.currentPrice, 'CA');

                                sets[item.setNumber] = {
                                    store: 'Toy Sense',
                                    link: item.link,
                                    setNumber: item.setNumber,
                                    title: item.title,
                                    price: item.currentPrice,
                                    savings: null,
                                    percentageOff: null,
                                    passesAmazonThreshold: null,
                                    caCurrencyExchangeBonusOff: null,
                                    usCurrencyExchangeBonusOff: null,
                                    ukCurrencyExchangeBonusOff: null
                                };

                                falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/toysense.html', {'Toy Sense': sets}, 'CA');
                            });

                            return;
                        }

                        sets[item.setNumber] = {
                            store: 'Toy Sense',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.currentPrice ? item.currentPrice : item.originalPrice,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };

                        falcon.shouldNotifyAboutSet('Toy Sense', item.title, item.setNumber, item.link, item.currentPrice, 'CA');
                    });

                    falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/toysense.html', {'Toy Sense': sets}, 'CA');
                });
                runTRUCanada(function(items) {
                    var sets = {};

                    items.forEach(function(item) {
                        if (!item.setNumber) { return; }

                        falcon.shouldNotifyAboutSet('TRU', item.title, item.setNumber, item.link, item.currentPrice ? item.currentPrice : item.originalPrice, 'CA');
                    
                        sets[item.setNumber] = {
                            store: 'TRU',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.currentPrice ? item.currentPrice : item.originalPrice,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };
                    });

                    falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/tru.html', {'TRU': sets}, 'CA');

                });
                runEbayTRUCanada(function(items) {
                    var sets = {};

                    items.forEach(function(item) {
                        if (!item.setNumber) { return; }

                        falcon.shouldNotifyAboutSet('TRU eBay', item.title, item.setNumber, item.link, item.currentPrice ? item.currentPrice : item.originalPrice, 'CA');
                    
                        sets[item.setNumber] = {
                            store: 'TRU eBay',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.currentPrice ? item.currentPrice : item.originalPrice,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };
                    });

                    falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/tru-ebay.html', {'TRU eBay': sets}, 'CA');
                });
                runWalmartCanada(function(items) {
                    items.forEach(function(item) {
                        if (!item.setNumber) { return; }

                        if (item.inStockOnline === 'In stock online' || item.inStockOnline === 'Limited stock online') {
                            falcon.shouldNotifyAboutSet('Walmart', item.title, item.setNumber, item.link, item.currentPrice ? item.currentPrice : item.originalPrice, 'CA');
                        }
                    });
                });
                // TODO fix pagination
                runChapters(function(items) {
                    var sets = {};

                    items.forEach(function(item) {
                        if (!item.setNumber) {
                            falcon.getSetNumberFromTitle(item.title, function(setNumber) {
                                item.setNumber = setNumber;

                                falcon.shouldNotifyAboutSet('Chapters', item.title, item.setNumber, item.link, item.currentPrice, 'CA');

                                sets[item.setNumber] = {
                                    store: 'Chapters',
                                    link: item.link,
                                    setNumber: item.setNumber,
                                    title: item.title,
                                    price: item.currentPrice,
                                    savings: null,
                                    percentageOff: null,
                                    passesAmazonThreshold: null,
                                    caCurrencyExchangeBonusOff: null,
                                    usCurrencyExchangeBonusOff: null,
                                    ukCurrencyExchangeBonusOff: null
                                };
                            });

                            return;
                        }

                        if (item.inStockOnline === 'In stock online') {
                            falcon.shouldNotifyAboutSet('Chapters', item.title, item.setNumber, item.link, item.currentPrice ? item.currentPrice : item.originalPrice, 'CA');
                        }

                        sets[item.setNumber] = {
                            store: 'Chapters',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.currentPrice ? item.currentPrice : item.originalPrice,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };
                    });

                    falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/chapters.html', {'Chapters': sets}, 'CA');
                });
                runCostcoCanada(function(items) {
                    var sets = {};

                    items.forEach(function(item) {
                        if (!item.setNumber) {
                            var url = 'https://www.google.com/search?q=brickset+' + item.title + '&aqs=chrome..69i57.285j0j1&sourceid=chrome&es_sm=91&ie=UTF-8';

                            // Fetch data from Brickset
                            request.get(url, function(err, response, body) {
                                if (err || response.statusCode != 200) { return; }

                                var match = /sets\/([0-9]*)-1/gi.exec(body);

                                if (!match) { return; }

                                item.setNumber = match[1];

                                falcon.shouldNotifyAboutSet('Costco', item.title, item.setNumber, item.link, item.currentPrice, 'CA');
                                
                                sets[item.setNumber] = {
                                    store: 'Costco',
                                    link: item.link,
                                    setNumber: item.setNumber,
                                    title: item.title,
                                    price: item.currentPrice,
                                    savings: null,
                                    percentageOff: null,
                                    passesAmazonThreshold: null,
                                    caCurrencyExchangeBonusOff: null,
                                    usCurrencyExchangeBonusOff: null,
                                    ukCurrencyExchangeBonusOff: null
                                };

                                falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/costco.html', {'Costco': sets}, 'CA');
                              });

                            return;
                        }

                        falcon.shouldNotifyAboutSet('Costco', item.title, item.setNumber, item.link, item.currentPrice, 'CA');
                        
                        sets[item.setNumber] = {
                            store: 'Costco',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.currentPrice ? item.currentPrice : item.originalPrice,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };
                        
                        falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/costco.html', {'Costco': sets}, 'CA');
                    });
                });
                runLondonDrugs(function(items) {
                    var sets = {};

                    items.forEach(function(item) {
                        if (!item.setNumber) { return; }

                        falcon.shouldNotifyAboutSet('London Drugs', item.title, item.setNumber, item.link, item.currentPrice ? item.currentPrice : item.originalPrice, 'CA');
                    
                        sets[item.setNumber] = {
                            store: 'London Drugs',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.currentPrice ? item.currentPrice : item.originalPrice,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };
                    });

                    falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/londondrugs.html', {'London Drugs': sets}, 'CA');
                });
                runCanadianTire(function(items) {
                    var sets = {};

                    items.forEach(function(item) {
                        if (!item.setNumber) {
                            var url = 'https://www.google.com/search?q=brickset+' + item.title + '&aqs=chrome..69i57.285j0j1&sourceid=chrome&es_sm=91&ie=UTF-8';

                            // Fetch data from Brickset
                            request.get(url, function(err, response, body) {
                                if (err || response.statusCode != 200) { return; }

                                var match = /sets\/([0-9]*)-1/gi.exec(body);

                                if (!match) { return; }

                                item.setNumber = match[1];

                                falcon.shouldNotifyAboutSet('Canadian Tire', item.title, item.setNumber, item.link, item.salePrice ? item.salePrice : item.currentPrice, 'CA');

                                sets[item.setNumber] = {
                                    store: 'Canadian Tire',
                                    link: item.link,
                                    setNumber: item.setNumber,
                                    title: item.title,
                                    price: item.currentPrice,
                                    savings: null,
                                    percentageOff: null,
                                    passesAmazonThreshold: null,
                                    caCurrencyExchangeBonusOff: null,
                                    usCurrencyExchangeBonusOff: null,
                                    ukCurrencyExchangeBonusOff: null
                                };

                                falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/canadiantire.html', {'Canadian Tire': sets}, 'CA');
                              });

                            return;
                        }

                        falcon.shouldNotifyAboutSet('Canadian Tire', item.title, item.setNumber, item.link, item.salePrice ? item.salePrice : item.currentPrice, 'CA');
                    
                        sets[item.setNumber] = {
                            store: 'Canadian Tire',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.salePrice ? item.salePrice : item.currentPrice,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };
                    });

                    falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/canadiantire.html', {'Canadian Tire': sets}, 'CA');

                });
                runAmazonCanada(function(items) {
                    var countryCode = 'CA';

                    var sets = {};

                    items.forEach(function(item) {
                        if (!item.setNumber) {
                            var url = 'https://www.google.com/search?q=brickset+' + item.title + '&aqs=chrome..69i57.285j0j1&sourceid=chrome&es_sm=91&ie=UTF-8';

                            // Fetch data from Brickset
                            request.get(url, function(err, response, body) {
                                if (err || response.statusCode != 200) { return; }

                                var match = /sets\/([0-9]*)-1/gi.exec(body);

                                if (!match) { return; }

                                item.setNumber = match[1];

                                falcon.shouldNotifyAboutSet('Amazon', item.title, item.setNumber, item.link, item.currentPrice ? item.currentPrice : item.originalPrice, 'CA');
                              
                                sets[item.setNumber] = {
                                    store: 'Amazon',
                                    link: item.link,
                                    setNumber: item.setNumber,
                                    title: item.title,
                                    price: item.currentPrice ? item.currentPrice : item.originalPrice,
                                    savings: null,
                                    percentageOff: null,
                                    passesAmazonThreshold: null,
                                    caCurrencyExchangeBonusOff: null,
                                    usCurrencyExchangeBonusOff: null,
                                    ukCurrencyExchangeBonusOff: null
                                };
                              });

                            falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/amazon-ca.html', {'Amazon': sets}, 'CA');

                            return;
                        }

                        falcon.shouldNotifyAboutSet('Amazon', item.title, item.setNumber, item.link, item.currentPrice ? item.currentPrice : item.originalPrice, 'CA');

                        sets[item.setNumber] = {
                            store: 'Amazon',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.currentPrice ? item.currentPrice : item.originalPrice,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };
                    });

                    falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/amazon-ca.html', {'Amazon': sets}, 'CA');
                });
                runBestBuyCanada(function(items) {
                    var sets = {};

                    items.forEach(function(item) {
                        if (!item.setNumber) { return; }

                        if (item.inStockOnline === 'Available online only') {
                            falcon.shouldNotifyAboutSet('Best Buy', item.title, item.setNumber, item.link, item.currentPrice ? item.currentPrice : item.originalPrice, 'CA');
                        }

                        sets[item.setNumber] = {
                            store: 'Best Buy',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.currentPrice ? item.currentPrice : item.originalPrice,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };
                    });

                    falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/bestbuy.html', {'Best Buy': sets}, 'CA');

                });
                runPlayValueToys(function(items) {
                    var sets = {};

                    items.forEach(function(item) {
                        falcon.shouldNotifyAboutSet('Playvalue Toys', item.title, item.setNumber, item.link, item.currentPrice ? item.currentPrice : item.originalPrice, 'CA');

                        sets[item.setNumber] = {
                            store: 'Playvalue Toys',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.currentPrice ? item.currentPrice : item.originalPrice,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };
                    });

                    falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/playvaluetoys.html', {'Playvalue Toys': sets}, 'CA');
                });
                runMigaToy(function(items) {
                    var sets = {};

                    items.forEach(function(item) {
                        falcon.shouldNotifyAboutSet('Miga Toy', item.title, item.setNumber, item.link, item.currentPrice ? item.currentPrice : item.originalPrice, 'CA');

                        sets[item.setNumber] = {
                            store: 'Miga Toy',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.currentPrice ? item.currentPrice : item.originalPrice,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };
                    });

                    falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/migatoy.html', {'Miga Toy': sets}, 'CA');
                });
                runSearsCanada(function(items) {
                    var sets = {};

                    items.forEach(function(item) {
                        if (!item.setNumber) {
                            var url = 'https://www.google.com/search?q=brickset+' + item.title + '&aqs=chrome..69i57.285j0j1&sourceid=chrome&es_sm=91&ie=UTF-8';

                            // Fetch data from Brickset
                            request.get(url, function(err, response, body) {
                                if (err || response.statusCode != 200) { return; }

                                var match = /sets\/([0-9]*)-1/gi.exec(body);

                                if (!match) { return; }

                                item.setNumber = match[1];

                                falcon.shouldNotifyAboutSet('Sears', item.title, item.setNumber, item.link, item.price, 'CA');

                                sets[item.setNumber] = {
                                    store: 'Sears',
                                    link: item.link,
                                    setNumber: item.setNumber,
                                    title: item.title,
                                    price: item.price,
                                    savings: null,
                                    percentageOff: null,
                                    passesAmazonThreshold: null,
                                    caCurrencyExchangeBonusOff: null,
                                    usCurrencyExchangeBonusOff: null,
                                    ukCurrencyExchangeBonusOff: null
                                };

                                falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/sears.html', {'Sears': sets}, 'CA');
                              });

                            return;
                        }

                        falcon.shouldNotifyAboutSet('Sears', item.title, item.setNumber, item.link, item.price, 'CA');

                        sets[item.setNumber] = {
                            store: 'Sears',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.price,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };

                        falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/sears.html', {'Sears': sets}, 'CA');
                    });
                });
                runMastermindToys(function(items) {
                    var sets = {};

                    items.forEach(function(item) {
                        if (!item.setNumber) {
                            var url = 'https://www.google.com/search?q=brickset+' + item.title + '&aqs=chrome..69i57.285j0j1&sourceid=chrome&es_sm=91&ie=UTF-8';

                            // Fetch data from Brickset
                            request.get(url, function(err, response, body) {
                                if (err || response.statusCode != 200) { return; }

                                var match = /sets\/([0-9]*)-1/gi.exec(body);

                                if (!match) { return; }

                                item.setNumber = match[1];

                                //falcon.shouldNotifyAboutSet('Mastermind Toys', item.title, item.setNumber, item.link, item.currentPrice, 'CA');
                              });

                            return;
                        }

                        //falcon.shouldNotifyAboutSet('Mastermind Toys', item.title, item.setNumber, item.link, item.currentPrice, 'CA');
                    });
                });
                // runAmazonUS(function(items) {
                //     console.log(items);

                //     var countryCode = 'US';

                //     var runItem = function(item, set) {
                //         falcon.shouldNotifyAboutSet('Amazon', item.title, item.setNumber, item.link, item.currentPrice ? item.currentPrice : item.originalPrice, 'US');
                //     };

                //     items.forEach(function(item) {
                //         var set = sets[item.setNumber];

                //         if (!set || !set[countryCode + 'RetailPrice']) {
                //             console.log('No data or RRP for ' + item.setNumber);
                //             fetchSet({setNumber: item.setNumber}, countryCode, function(set) {
                //                 runItem(item, set);
                //             });
                //         }
                //         else {
                //             runItem(item, set);
                //         }
                //     });
                // });
                runTRUUSA(function(items) {
                    var sets = {};

                    items.forEach(function(item) {
                        if (!item.setNumber) { return; }

                        falcon.shouldNotifyAboutSet('TRU', item.title, item.setNumber, item.link, item.currentPrice ? item.currentPrice : item.originalPrice, 'CA');
                    
                        sets[item.setNumber] = {
                            store: 'TRU',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.currentPrice ? item.currentPrice : item.originalPrice,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };
                    });

                    falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/tru-usa.html', {'TRU': sets}, 'US');

                });
                runAmazonUK(function(items) {
                    var countryCode = 'UK';
                    var sets = {};

                    items.forEach(function(item) {
                        if (!item.setNumber) { return; }

                        falcon.shouldNotifyAboutSet('Amazon', item.title, item.setNumber, item.link, item.currentPrice ? item.currentPrice : item.originalPrice, countryCode);
                    
                        sets[item.setNumber] = {
                            store: 'Amazon',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.currentPrice ? item.currentPrice : item.originalPrice,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };
                    });

                    falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/amazon-uk.html', {'Amazon': sets}, 'UK');

                });

                runAmazonFR(function(items) {
                    var countryCode = 'EU';
                    var sets = {};

                    items.forEach(function(item) {
                        if (!item.setNumber) { return; }

                        falcon.shouldNotifyAboutSet('Amazon FR', item.title, item.setNumber, item.link, item.currentPrice ? item.currentPrice : item.originalPrice, countryCode);
                    
                        sets[item.setNumber] = {
                            store: 'Amazon FR',
                            link: item.link,
                            setNumber: item.setNumber,
                            title: item.title,
                            price: item.currentPrice ? item.currentPrice : item.originalPrice,
                            savings: null,
                            percentageOff: null,
                            passesAmazonThreshold: null,
                            caCurrencyExchangeBonusOff: null,
                            usCurrencyExchangeBonusOff: null,
                            ukCurrencyExchangeBonusOff: null
                        };
                    });

                    falcon.generateDealsPage('/Users/ericmuyser/sync/Public/deals/amazon-fr.html', {'Amazon FR': sets}, 'EU');

                });